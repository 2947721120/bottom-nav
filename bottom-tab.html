<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-behaviors/iron-button-state.html">
<link rel="import" href="../iron-behaviors/iron-control-state.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">

<!-- TODO: improve docs -->

<!--
     `bottom-tab`
bottom-tab is a tab element for navigating the pages of a bottom-nav. Each tab
is used to navigate pages in the app. Optional labels can be used for the tabs
to clarify the button meaning. An iron-icon is also used to assign logos to
each tab.

     <bottom-nav>
       <bottom-toolbar>
         <bottom-tab label="Home" icon="icons:home"></bottom-tab>
         <bottom-tab label="Favorites" icon="icons:favorite"></bottom-tab>
         <bottom-tab label="Recent" icon="icons:clock"></bottom-tab>
       </bottom-toolbar>
     </bottom-nav>

## Styling

Mixin | Description | Default
------|-------------|----------
`--bottom-tab` | Mixin applied to the tab | `{}`
`--bottom-tab-content` | Mixin applied to the tab content | `{}`
`--bottom-tab-content-unselected` | Mixin applied to the tab content when the tab is not selected | `{}`

     @demo demo/index.html
 -->

<dom-module id="bottom-tab">
  <template>
    <style>
     :host {
       @apply(--layout-inline);
       @apply(--layout-center);
       @apply(--layout-center-justified);
       @apply(--layout-flex-auto);

       position: relative;
       padding: 0 12px;
       overflow: hidden;
       cursor: pointer;
       vertical-align: middle;

       @apply(--paper-font-common-base);
       @apply(--bottom-tab);
     }

     :host(:focus) {
       outline: none;
     }

     :host([link]) {
       padding: 0;
     }

     .tab-content {
       height: 100%;
       transform: translateZ(0);
       -webkit-transform: translateZ(0);
       transition: opacity 0.1s cubic-bezier(0.4, 0.0, 1, 1);
       @apply(--layout-horizontal);
       @apply(--layout-center-center);
       @apply(--bottom-tab-content);
     }

     :host(:not(.iron-selected)) > .tab-content {
       opacity: 0.8;

       @apply(--layout-vertical);
       @apply(--layout-flex-auto);
       @apply(--bottom-tab-content-unselected);
     }

     :host(:not(.iron-selected)) :not([show]).label {
       display: none;
     }

     :host(:focus) .tab-content {
       opacity: 1;
       font-weight: 700;
     }

     .tab-content > ::content > a {
       @apply(--layout-flex-auto);

       height: 100%;
     }

     :host(.iron-selected) {
       @apply(--layout-flex-2);
     }

     :host(.iron-selected) > .tab-content {
       font-size: 10pt;
       margin-bottom: 6px;
       transition: margin-bottom .1s cubic-bezier(0.4, 0.0, 1, 1);

       @apply(--layout-vertical);
       @apply(--bottom-tab-content-selected);
     }
    </style>

    <div class="tab-content">
      <iron-icon icon="[[icon]]"></iron-icon>
      <span show$="[[showLabel]]" class="label">[[label]]</span>
    </div>
  </template>

  <script>
   Polymer({
     is: 'bottom-tab',

     behaviors: [
       Polymer.IronControlState,
       Polymer.IronButtonState
     ],

     properties: {

       /**
        * If true, the tab will forward keyboard clicks (enter/space) to
        * the first anchor element found in its descendants
        */
       link: {
         type: Boolean,
         value: false,
         reflectToAttribute: true
       },

       /**
        * A label for the tab that is hidden when not active.
        */
       label: String,

       /**
        * Whether the label should be displayed or hidden, default hidden
        */
       showLabel: {
         type: Boolean,
         value: false
       },

       /**
        * The name of an icon to display
        */
       icon: String
     },

     hostAttributes: {
       role: 'tab'
     },

     listeners: {
       down: '_updateNoink',
       tap: '_onTap'
     },

     attached: function() {
       this._updateNoink();
     },

     get _parentNoink () {
       var parent = Polymer.dom(this).parentNode;
       return !!parent && !!parent.noink;
     },

     _updateNoink: function() {
       this.noink = !!this.noink || !!this._parentNoink;
     },

     /**
      * Fire a ripple event when the tab isn't selected
      */
     _activateRipple: function(event) {
       var tabIndex = Polymer.dom(this).node.getAttribute('tabindex');

       if (tabIndex == -1) {
         var x = event.detail.x,
             y = event.detail.y,
             details = {x: x, y: y};

         this.fire('bottom-tab-ripple', details);
       }
     },

     _onTap: function(event) {
       if (this.link) {
         var anchor = this.queryEffectiveChildren('a');

         if (!anchor) {
           return;
         }

         // Don't get stuck in a loop delegating
         // the listener from the child anchor
         if (event.target === anchor) {
           return;
         }

         anchor.click();
       }

       this._activateRipple(event);
     }

   });
  </script>
</dom-module>
